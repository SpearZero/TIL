## 3. 도메인 복잡성 관리

### 일관성 없는 모델
리드(lead)라는 용어가 마케팅과 영업부서에서 서로 다른 의미로 사용된다.
- 각 용어는 하나의 의미를 가져아 하며, 도메인 전문가의 멘탈 모델을 반영해야 한다.
- 마케팅, 영업부서에서 '리드'의 멘탈 모델은 차이가 존재한다.

이러한 모호성은 개인의 의사소통에서는 큰 문제가 되지 않지만 소프트웨어로 표현하는데는 어려움이 있다.
- 영업부서의 복잡한 모델을 마케팅 부서에 적용하면 필요하지 않는 곳에서 복잡성을 키운다.
- 마케팅 부서의 관점에 따라 영업 모델을 단순화 하려고 하면 영업 프로세스를 관리하고 최적화하기에는 너무 단순하기 때문에 영업 하위 도메인의 요구에 맞지 않음

이 문제를 해결하는 방법
- 모든 종류의 문제에 사용할 수 있는 단일 모델을 설계
    - 복잡성에 직면하게 된다.
    - 관련없는 세부 사항을 필터링 하는 복잡성
    - 필요한 것을 찾는 복잡성
    - 데이터를 일관된 상태로 유지해야 하는 복잡성
- 정의에 문제가 있는 용어 앞에 접두사를 붙인다.
    - '마케팅 리드', '영업 리드'
    - 인지 부하를 유발한다.
        - 각 모델을 언제 사용해야 할지를 구분하기 어려움
    - 모델의 구현이 유비쿼터스 언어와 일치하지 않음
        - 아무도 대화에 접두어를 사용하지 않고 대화의 맥락에 의존해 소통할 수 있다.

이러한 시나리오를 다루기 위해 도메인 주도 설계 패턴 중 하나인 바운디드 컨텍스트가 존재한다.

### 바운디드 컨텍스트란 무엇인가?
일관성 없는 모델의 솔루션은 바운디드 컨텍스트를 사용하면 된다.
- 유비쿼터스 언어를 여러 개의 작은 언어로 나눈 다음 각 언어를 적용할 수 있는 명시적인 <b>바운디드 컨텍스트(bounded context)</b>에 할당하면 된다.

마케팅과 영업은 '마케팅', '영업' 두 가지 바운디드 컨텍스트를 식별할 수 있다.
- 리드(lead)라는 용어는 두 바운디드 컨텍스트에 모두 존재한다.
- 리드라는 용어는 각각 일관성을 띠며 도메인 전문가의 멘탈 모델을 따를 수 있다.

#### 모델 경계
- 하나의 바운디드 컨텍스트의 유비쿼터스 언어는 다른 바운디드 컨텍스트의 범위에는 완전히 관련이 없다.
- 서로 다른 문제 도메인에 따라 고유한 모델을 정의할 수 있다.
- 유비쿼터스 언어의 용어, 원칙, 비즈니스 규칙은 해당 바운디드 컨텍스트 내에서만 일관성이 있다.

#### 정제된 유비쿼터스 언어
- 유비쿼터스 언어는 바운디드 컨텍스트 경계 안에서만 보편적으로 적용된다.
- 유비쿼터스 언어는 바운디드 컨텍스트에 포함된 모델에 설명하는 데만 집중한다.
- 모델은 우리가 해결해야 하는 문제 없이는 존재할 수 없기 때문에 유비쿼터스 언어는 명시적으로 적용 가능한 컨텍스트 없이 정의하거나 사용할 수 없다.

#### 바운디드 컨텍스트의 범위
유비쿼터스 언어의 범위(바운디드 컨텍스트)를 정의하는 것은 전략적인 설계 의사결정이다.
- 비즈니스 도메인의 고유한 컨텍스트에 따라 넓힐 수 있고, 비즈니스 도메인을 더 작은 도메인으로 세분화하여 좁힐 수 있다.

유비쿼터스 언어의 경계가 넓을수록 일관성을 유지하기가 어렵고, 바운디드 컨텍스트를 작게 만들기 위해 노력하는 것은 역효과를 낼 수 있음
- 바운디드 컨텍스트에 대한 결정은 도메인이 무엇이냐에 따라 달라진다.
    - 경우에 따라 넓은 경계가 또는 분해가 더 합리적일 수 있다.

큰 바운디드 컨텍스트를 세분화된 바운디드로 추출하는 이유
- 새로운 소프트웨어 엔지니어링 팀 구성
- 시스템의 일부 비기능 요구사항을 해결하는 것
- 추출 예시
    - 원래 단일 바운디드 컨텍스트에 있던 일부 컴포넌트의 개발 수명주기를 분리해야 하는 경우
    - 바운디드 컨텍스트의 나머지 기능과 독립적으로 확장 가능

바운디드 컨텍스트를 나누는 것에 대한 주의사항
- 바운디드 컨텍스트를 작게 나누는 게 항상 좋은 건 아니다.
    - 기능이 서로 강하게 연결되어 있고 자주 함께 변경된다면(응집도가 높음), 한 컨텍스트 안에 두는 게 좋다.
        - 컨텍스트가 나뉘면 하나를 배포하면 나머지도 동시에 수정 배포해야 한다.

### 바운디드 컨텍스트 대 하위 도메인

#### 하위 도메인
소프트웨어 엔지니어는 요구사항을 정의하지 않는다. 비즈니스가 담당한다. 소프트웨어 엔지니어는 하위 도메인(핵심, 지원, 일반)을 식별하기 위해 비즈니스 도메인을 분석한다.

#### 바운디드 컨텍스트
바운디드 컨텍스트는 소프트웨어 엔지니어에 의해 설계된다. 모델의 경계를 선택하는 것은 전략적 설계의 의사결정이다.

#### 하위 도메인과 바운디드 컨텍스트 사이의 상호작용
바운디드 컨텍스트와 하위 도메인 간에 일대일 관계를 맺는 것이 완벽하게 합리적일 때가 있다. 어떤 경우에는 다른 분해 전략이 더 적합할 수 있다.

하위 도메인은 발견하고 바운디드 컨텍스트는 설계한다.
- 하위 도메인은 비즈니스 전략에 의해 정의된다.
- 소프트웨어 엔지니어는 특정 프로젝트의 컨텍스트와 제약 조건을 해결하기 위해 소프트웨어 솔루션과 바운디드 컨텍스트를 설계할 수 있다.

모델은 특정 문제를 해결하기 위한 것이다. 따라서 같은 개념이라도 해결하려는 문제가 다르다면, 여러 모델을 동시에 사용하는 것이 도움이 될 수 있다.
- 즉, 하위 도메인 하나에 바운디드 컨텍스트를 꼭 하나만 두라는 생각은 잘못이다.
같은 도메인이라도 문제와 목적이 다르면, 여러 바운디드 컨텍스트로 나누어 각자에 맞는 모델을 두는 것이 좋다.
- 바운디드 컨텍스트와 하위 도메인의 설계를 일대일 관계로 제한하면 이런 식의 유연성이 떨어지고 바운디드 컨텍스트 안에서 하나의 하위 도메인 모델만을 사용하게 된다.

### 경계
바운디드 컨텍스트 패턴
- 물리적 경계와 소유권 경계를 규정하기 위한 도메인 주도 설계 도구

#### 물리적 경계
- 바운디드 컨텍스트는 개별 서비스/프로젝트로 구현돼야 한다.
- 구현, 진화, 버전 관리를 각각의 다른 바운디드 컨텍스트와 독립적으로 해야 한다.
- 바운디드 컨텍스트는 여러 하위 도메인을 포함할 수 있다.
    - 바운디드 컨텍스트는 물리적 경계, 하위 도메인은 논리적 경계이다.

#### 소유권 경계
바운디드 컨텍스트는 하나의 팀이 전담하여 구현, 개선, 유지보수를 해야 한다. 이렇게 해야 다른 팀이 그 컨텍스트의 내부 모델에 대해 임의로 추측하거나 의존하지 않게 된다.

### 결론
- 도메인 전문가의 멘탈 모델에 내재된 충돌을 발견할 때마다 유비쿼터스 언어를 여러 개의 바운디드 컨텍스트로 분해해야 한다.
- 하위 도메인이 발견되면 바운디드 컨텍스트도 설계한다. 도메인을 바운디드 컨텍스트로 나누는 것은 전략적 설계의 의사결정이다.
- 바운디드 컨텍스트와 유비쿼터스 언어는 한 팀에서 만들고 유지보수할 수 있다.
    - 한 팀이 여러 개의 바운디드 컨텍스트에서 일하는 것은 가능하다.
- 각 바운디드 컨텍스트의 수행주기는 서로 독립적이다.
    - 그러나 바운디드 컨텍스트는 시스템을 구성하기 위해 함께 작동해야 한다.
    - 일부 변경은 의도치 않게 다른 바운디드 컨텍스트에 영향을 줄 수 있다.