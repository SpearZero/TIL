## 다중 액세스 프로토콜

호스트와 게이트웨이 라우터는 공용케이블에 맞물려 있다.
- 유선이든 무선이든 간에 호스트와 게이트웨이 라우터간에 전용선이 있는게 아니다. BroadCast Medium(전파매체)을 통해 라우터와 연결
- Medium은 하나의 매체
- WiFi의 목적지는 게이트웨이 라우터지만 전자기파 신호가 모두에게 전파됨
- 두 개 이상의 패킷이 동시에 전송되면 충돌된다.

다른 계층은 프로토콜은 많지만, 네트워크 계층은 IP 하나임

TCP, IP는 OS에 구현되어있다.

링크 계층은 OS일부와, NIC(네트워크 인터페이스 카드)에 부분적으로 구현되어 있음

Medium Access Control(MAC)
- 여러 호스트가 액세스하려고하는데 잘 컨트롤해서 Collision(충돌)이 안나게 할것인가

WiFi
- 하나의 닉네임일 뿐임
- 실제 프로토콜이름은 802.11

맥 프로토콜의 이상적인 지향
- Link BandWith가 R이라고 했을 때
    - A가 한사람이면 R 전체를 사용할 수 있어야 한다.
    - 전부다 동시에 사용하고 싶으면 1/n 씩 공평하게 R을 사용할 수 있어야 한다.
    - 분산적인 계산이 있어야 함
    - 단순해야 한다.

MAC 프로토콜 세 가지 분류
- 파티셔닝(channel partitioning)
    - TDMA : time division multiple access
        - 시간을 나눠서 access함
        - 시간을 배정해준다.(slot에 배정)
        - 단점 : 사용하지 않아도 배정해줬기 때문에 낭비가 된다.
    - FDMA : frequence division multiple access
        - 주파수를 나눈다.
        - 단점 : 사용하지 않으면 주파수가 낭비된다.
    - 사용자가 많으면 효율적이다.(충돌이 나지 않음)
    - 자신의 슬롯만 사용할 수 있어서 낭비임(사용하지 않을 때 낭비가 된다.)
- 랜덤 액세스(random access)
    - 파티셔닝의 단점과 장점이 반대
    - 할 얘기가 있을때 하는 방법
        - A호스트만 access하고 싶으면 access함
    - Collision이 발생함
        - 탐지를 하고 Recovery를 어떻게 해야할지 명시를 해야 한다.
    - CSMA : carrier sense multiple access
        - carrier sense
            - 내가 전송하고 싶은 프레임이 있을 때, 전송하기 전에 듣고 있다가 아무도 전송안하면 전송한다.
        - 동시에 접근할 때는 충돌이 생기게 된다.(동시에 프레임을 전송할 때)
            - 충돌하면 프레임이 다 날아감
            - 충돌이 발생해도 계속 프레임을 보낸다.
        - Collision을 완전히 없앨 수는 없다.
            - 전자기파가 전송되는 속도보다 동시에 접근하는 속도가 빠른경우
            - Collision에서 발생하는 피해를 최소화하는 방법을 생각해야 한다.
    - CSMA/CD : (collision detection)
        - 프레임이 충돌한 경우는 쓸모없는 값이 된다.
        - 충돌시 프레임 전송을 중단시킨다.
            - 충돌 탐지시 전송을 멈춘다.
        - 충돌시의 피해를 줄인다.
        - 충돌시 프레임 전송을 중단시켰으면, 재전송을 시켜야 한다.
            - 랜덤 타이머를 돌리다 그 후에 재전송
            - 재전송시 또 충돌이나면 또 랜덤 타이머를 돌린다.
            - 재전송의 핵심
                - 시간낭비를 줄이는게 좋다.
                - 랜덤 타이머 시간이 짧을수록 재전송을 더 빨리 할 수 있어서 좋음
                    - 랜덤 타이머가 짧으면 또 충돌이 일어날 수도 있다.(주기가 짧으므로)
                    - 첫 충돌은 짧게, 하지만 또 충돌이 있으면 주기를 계속해서 늘린다.
                        - binary exponential backoff
                    - 몇 명이 충돌되었는지 모름
                        - 짧게 재전송 함
                        - 사람이 많아서 또 충돌되면 재전송 주기를 늘린다.
                        - 전송하고자 하는 호스트가 많을수록 타이머 주기가 길어진다.
        - 충돌 감지는 쉽다.(유선상에서)
            - 자신이 보낸 시그널 세기와 다른 곳에서 온 시그널 세기가 비슷함(유선)
            - 무선의 경우는 외부로부터 잡음(노이즈)을 보호할 수 없음
                - 자신의 신호가 세기 때문에 신호가 합성되더라도 노이즈 처럼 들리지가 않음
- Taking turns
    - channel partitioning과 random access이 장점 단점이 명확함
        - channel partition
            - 사용자가 많을 수록 좋다.(사용자가 다 사용하므로)
        - random access
            - 사용자가 적을수록 좋다. 사용자가 많으면 충돌을 해결해야 함
    - 현실적으로 많이 쓰이지 않는다.
    - polling
        - master node : 각 slaves node들에게 세그먼트를 전송할것이 있는지 물어봄
            - 잘 사용하지 않음
            - 분산이 되지 않음, 중앙집중
    - token passing
        - 토큰을 가진 호스트만이 프레임을 전송할 수 있다.
            - 보낼 데이터가 있으면 데이터를 보내고, 보낼 데이터가 없으면 토큰을 전달한다.
            - 잘 사용하지 않음
            - 토큰을 잃어버리면 안된다.
            - spof : 한 곳에서 망하면 망함

이더넷과 와이파이는 랜덤 액세스를 사용함

채널 파티셔닝은 이동통신에서 사용

이더넷
- 유선 구조
- 예전에는 topology가 버스구조, 현재는 star 구조

이더넷 프레임 구조
- IP 패킷이 링크 레이어로 내려와서 이더넷에 담김
- 데이터 부분에 IP 패킷이 들어감
- 맨 뒤에 CRC라는 필드가 있음
    - 에러 체킹을 위한 필드
- 이더넷 헤더
    - 프리앰블
    - destination address
    - source address
    - type(데이터 타입)

이더넷에서 address는 IP주소가 아닌 링크 계층에서 사용하는 맥 주소임

이더넷은 CSMA/CD를 사용함
- random access를 하되 collision을 처리

링크 계층의 목표
- 프레임이 충돌되지 않고 라우터에 가는게 목표
- 각 링크의 라우터끼리 충돌이 나지 않고 가는것이 목표

CSMA/CD에서 프레임을 전달할 때는 피드백이 없음
- 프레임을 전달했을 때 라우터는 피드백을 주지 않음
- 프레임이 라우터까지 전달되었는지에 대한 확신이 없다.
    - 유선상황에서는 외부로부터 노이즈(잡음)은 없다.
    - 사실 충돌만 없으면 프레임은 전달된다.
        - 그래서 피드백이 필요 없음
        - 따라서 충돌이 있으면 재전송이 있어야 한다.
    - CSMA/CD에서 중요한것은 "collision detection"(충돌 감지)
        - 충돌이 있음에도 감지를 못하면 안된다.
        - 충돌 감지가 100% 되어야 함
            - 충돌 감지를 하지 못하면 프레임이 버려짐(피드백도 없으므로)
- 충돌났는데도 감지를 못하면 재전송을 안하고 프레임을 잃게됨
    - A, B, C, D, E, F, G 에서 A에서 신호를 보내는 중 G가 보냈을 때 G는 충돌감지를 하고 중지했지만 중지 전의 짧은 프레임이 A에게 전송되는 중에 A의 프레임 전송이 끝나는 경우
    - A의 프레임 사이즈가 컸다면(충분 했다면) G에서 오는 충돌을 감지할 수 있었다.
        - 랜선의 길이와 전파 딜레이를 감안해서 프레임 사이즈의 최소 사이즈가 정해져있다.
        - 충돌음 감지하기 위해서
        - 프레임 사이즈가 최소보다 적으면 padding을 붙임