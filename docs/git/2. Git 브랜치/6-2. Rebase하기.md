> https://git-scm.com/book/ko/v2/Git-%EB%B8%8C%EB%9E%9C%EC%B9%98-Rebase-%ED%95%98%EA%B8%B0#_merge_rebase_work
 
## Rebase 하기
### Rebase의 위험성

**이미 공개 저장소에 Push한 내용을 Rebase 하지 마라** <br>
이 지침만 지킨다면 Rebase하는 데 문제없다. Rebase는 기존의 커밋을 그대로 사용하는 것이 아니라 내용은 같지만 다른<br> 커밋을 새로 만든다. 새 커밋을 서버에 Push하고 동료 중 누군가가 그 커밋을 Pull 해서 작업을 한다고 하자. 그런데 그 커밋을<br> git rebase로 바꿔서 Push 해버리면  동료는 다시 Merge 해야한다. 그리고 동료가 다시 Merge한 내용을 Pull 하면 자신의 코드는<br> 엉망이 되어버린다.<br>
![perils-of-rebasing-1](./pic/perils-of-rebasing-1.png)<br>
팀원중 누군가 커밋하고 Merge하고 Push했다. 이 리모트 브랜치를 Fetch하고 Merge하면 다음과 같이 된다.<br>
![perils-of-rebasing-2](./pic/perils-of-rebasing-2.png)<br>
이 때 Push했던 팀원이 Merge한 일을 되돌리고 다시 Rebase 한다. 서버의 히스토리를 새로 덮어씌우려면 git push --force<br>를 사용한다. 이후 저장소에서 다시 Fetch 하면 다음과 같은 상황이 된다.<br>
![perils-of-rebasing-3](./pic/perils-of-rebasing-3.png)<br>
git pull 명령어로 서버의 내용을 가져와서 Merge하면 같은 내용의 수정사항을 포함한 Merge 커밋이 만들어진다.<br>
![perils-of-rebasing-4](./pic/perils-of-rebasing-4.png)<br>
git log를 확인해보면 C4', C4에서 커밋 날짜, 메시지가 같게 된다. 이렇게 되면 혼란스럽다. C4와 C6은 포함되지 말았어야<br> 할 커밋이다. 애초에 서버에 보내기전에 Rebase로 정리해야 했다.

### Rebase 한 것을 다시 Rebase 하기
팀원이 자신이 한 일을 덮어 씌웠으면 자신이 했던 일 덮어쓴 내용이 무엇인지 알아내야 한다.<br>
Git은 커밋에 Patch할 내용으로 SHA-1 체크섬을 구한다. 이를 'patch-id'라고 한다.<br>
덮어쓴 커밋을 받아서 그 커밋을 기준으로 Rebase할 때 Git은 누가 작성한 코드인지 잘 찾아낸다.<br>

예를 들어 위로 위에 위에 사진의 상황에서 Merge하는 대신 git rebase teamone/master를 실행하면 Git은 <br> 다음과 같은 작업을 한다.
- 현재 브랜치에만 포함된 커밋을 찾는다.(C2,C3,C4,C6,C7)
- Merge 커밋을 가려낸다.(C2,C3,C4)
- 이 중 덮어쓰지 않은 커밋들만 골라낸다.(C2, C3, C4는 C4'와 동일한 Patch다)
- 남은 커밋들만 다시 teamone/master 바탕으로 커밋을 쌓는다.

![perils-of-rebasing-5](./pic/perils-of-rebasing-5.png)<br>

이러면 제대로 된 결과를 얻을 수 있다.<br>
동료가 생성했던 C4와 C4'이 커밋 내용이 완전히 같을 때만 이렇게 동작된다.<br>
git pull 명령을 실행할 때 옵션을 붙여 git pull --rebase로 Rebase할 수 있다. 물론 git fetch와 git rebase teamone/master 이 두<br> 명령어를 실행해도 된다.

git pull 명령어를 실행할 때 자동으로 --rebase 옵션이 적용되도록 git config --global pull.rebase true 명령을 추가할 수 있다.<br>

Push하기전에 Rebase하거나 혼자 Rebase 하는 경우는 괜찮다. 하지만 이미 공개하여 사람들이 사용하는 커밋을 Rebase하면<br> 문제가 생긴다.

### Rebase vs Merge
히스토리를 보는 관점 중에 하나는 **작업한 내용의 기록**으로 보는 것이 있다. 작업 내용을 기록한 문서이고, 각 기록은 의미를<br> 가지며 변경할 수 없다. 이런 관점에서 커밋 히스토리를 변경한다는 것은 역사를 부정하는 꼴이 된다.<br>
히스토리를 프로젝트가 **어떻게 진행되었나에 대한 이야기**로도 볼 수 있다. 세세한 작업 내용을 공개하고 싶지 않을 수 있다.<br> 나중에 다른 사람에게 들려주기 좋도록 Rebase나 filter-branch 같은 도구로 프로젝트의 진행 이야기를 다듬으면 좋을것이다.<br>

이 둘을 어떻게 사용할지는 각자의 판단에 달렸다 하지만 중요한것은<br>

**어딘가에 Push로 내보낸 커밋에 대해서는 절대 Rebase 하지 말아야 한다**